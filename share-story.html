<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Share Your Story - Unspoken Journey's</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --accent-color: #e74c3c;
      --text-color: #2c3e50;
      --light-bg: rgba(255, 255, 255, 0.95);
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: url('https://images.unsplash.com/photo-1457369804613-52c61a468e7d?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8c3RvcnklMjBiYWNrZ3JvdW5kfGVufDB8fDB8fHww') no-repeat center center fixed;
      background-size: cover;
      color: var(--text-color);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: var(--light-bg);
      padding: 40px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      width: 90%;
      max-width: 700px;
      margin: 20px auto;
      position: relative;
      animation: fadeIn 0.8s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      color: var(--primary-color);
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 2.2em;
      position: relative;
      padding-bottom: 15px;
    }

    .header h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--secondary-color);
    }

    .header p {
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .form-container {
      background: var(--light-bg);
      padding: 40px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      width: 90%;
      max-width: 700px;
      margin: 20px auto;
      position: relative;
      animation: fadeIn 0.8s ease-in-out;
    }

    input, textarea {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #d8a6a6;
      border-radius: 10px;
      font-size: 16px;
      background: white;
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    input:focus, textarea:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      outline: none;
    }

    #description {
      height: 60px;
      resize: vertical;
    }

    #story {
      height: 220px;
      font-size: 18px;
      resize: vertical;
    }

    .hashtag-suggestions {
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      position: absolute;
      width: calc(100% - 40px);
      max-height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
      border: 1px solid #e0e0e0;
    }

    .hashtag-suggestions div {
      padding: 12px 15px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid #f0f0f0;
    }

    .hashtag-suggestions div:hover {
      background: var(--secondary-color);
      color: white;
    }

    button {
      background: var(--secondary-color);
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      font-size: 16px;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:hover {
      background: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .bottom-nav {
      width: 100%;
      background: rgba(10, 10, 10, 0.98);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      bottom: 0;
      left: 0;
      padding: 0;
      box-shadow: none;
      border: none;
      z-index: 100;
    }

    .bottom-nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      padding: 18px 0;
      flex: 1 1 0;
      text-align: center;
      font-size: 16px;
      background: none;
      border: none;
      box-shadow: none;
      transition: background 0.2s, color 0.2s;
    }

    .bottom-nav a:hover {
      background: rgba(255,255,255,0.04);
      color: #fff;
      transform: none;
    }

    @media (max-width: 768px) {
      .form-container {
        padding: 20px;
        width: 95%;
      }

      .header h1 {
        font-size: 1.8em;
      }

      .bottom-nav {
        padding: 10px 0;
      }

      .bottom-nav a {
        padding: 8px 12px;
        font-size: 14px;
      }
    }

    .dark-mode-container {
      position: absolute;
      top: 15px;
      left: 20px;
      z-index: 1001;
    }
    .theme-toggle {
      color: white;
      background: #333;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s, transform 0.2s;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .theme-toggle:hover {
      background: #ffcc00;
      color: #141e30;
      transform: scale(1.05);
    }
    body.dark-mode {
      background: #141e30 !important;
      color: #fff;
    }
    body.dark-mode .container,
    body.dark-mode .form-container {
      background: rgba(20, 30, 48, 0.95);
      color: #fff;
    }
    body.dark-mode input,
    body.dark-mode textarea {
      background: #222;
      color: #fff;
      border-color: #444;
    }
    body.dark-mode .header h1,
    body.dark-mode .header p {
      color: #fff;
    }
    body.dark-mode .bottom-nav {
      background: #222;
    }
    body.dark-mode .bottom-nav a {
      color: #fff;
    }
    body.dark-mode .bottom-nav a:hover {
      background: #444;
      color: #ffcc00;
    }
  </style>
</head>
<body>
  <div class="dark-mode-container">
    <button class="theme-toggle" id="theme-toggle" title="Toggle dark/light mode">ðŸŒ™</button>
  </div>
  <div class="container">
    <div class="header">
      <h1>Share Your Story</h1>
      <p>Your experiences matter. Share your unique journey with us.</p>
    </div>
    <div class="form-container">
      <form id="story-form">
        <input type="text" id="title" name="title" placeholder="Enter the title of your story" required>
        <input type="text" id="hashtags" name="hashtags" placeholder="Enter hashtags (comma-separated)" onkeyup="showSuggestions()" required>
        <div class="hashtag-suggestions" id="suggestions-box"></div>
        <textarea id="description" name="description" placeholder="Write the conclusion of the story..." required></textarea>
        <textarea id="story" name="story" placeholder="Write your story here..." required></textarea>
        <button type="submit">Post Story</button>
      </form>
    </div>
  </div>

  <div class="bottom-nav">
    <a href="index.html">Home</a>
    <a href="stories.html">Stories</a>
    <a href="share-story.html">Share Your Story</a>
    <a href="contact.html">Contact</a>
    <a href="about-us.html">About Us</a>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <!-- <script src="database.js"></script>  No longer needed for core function -->
  <script>
    // Initialize Firebase directly in share-story page
    const firebaseConfig = {
        apiKey: "AIzaSyAkR4rQhTC9P9rIUpJzLUGLPDIxpYW0nrc",
        authDomain: "unspoken-journeys.firebaseapp.com",
        projectId: "unspoken-journeys",
        storageBucket: "unspoken-journeys.appspot.com",
        messagingSenderId: "1085239903802",
        appId: "1:1085239903802:web:1c8140e85ab72645f21703",
        measurementId: "G-CHFJNLYK08"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
        console.log('Firebase initialized in share-story page');
    } else {
        console.log('Firebase already initialized');
    }
    
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // Hashtag suggestion logic (remains the same)
    const availableHashtags = ["#Suspense", "#Comedy", "#Romance", "#Horror", "#SciFi", "#Drama", "#Fantasy", "#Historical","#Adventure", "#LifeLessons", "#Friendship", "#Love", "#Inspiration", "#Motivation", "#Travel", "#PersonalGrowth", "#Success", "#Happiness", "#SelfImprovement", "#Wellness", "#Mindfulness", "#Growth", "#Courage", "#Hope", "#Dreams", "#Storytelling", "#Achievement", "#LifeChanging", "#Passion", "#Hustle", "#Career", "#Family", "#LessonsLearned", "#Joy", "#Memories", "#Gratitude", "#OvercomingChallenges", "#NewBeginnings", "#Transformation", "#LifeJourney", "#Strength", "#SelfDiscovery", "#Kindness", "#Resilience", "#HappinessMatters", "#LifeGoals", "#Wisdom", "#HardWork", "#Creativity", "#ExpressYourself", "#EmotionalGrowth", "#Perseverance", "#LoveLife", "#Authenticity", "#Mindset", "#BelieveInYourself", "#InnerPeace", "#MentalHealthAwareness", "#StorySharing", "#Faith", "#Healing", "#ExperienceMatters", "#Determination", "#Encouragement", "#BeYourself"]
    function showSuggestions() {
        let input = document.getElementById("hashtags").value.toLowerCase();
        let suggestionsBox = document.getElementById("suggestions-box");
        suggestionsBox.innerHTML = "";
        if (input.length < 2) {
            suggestionsBox.style.display = "none";
            return;
        }
        let suggestions = availableHashtags.filter(tag => tag.toLowerCase().startsWith(input));
        suggestions.forEach(tag => {
            let div = document.createElement("div");
            div.textContent = tag;
            div.onclick = function() {
                document.getElementById("hashtags").value += (document.getElementById("hashtags").value ? ", " : "") + tag;
                suggestionsBox.style.display = "none";
            };
            suggestionsBox.appendChild(div);
        });
        suggestionsBox.style.display = suggestions.length ? "block" : "none";
    }

    // Handle story form submission
    document.getElementById('story-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const user = auth.currentUser; // Use the locally initialized auth
        if (!user) {
            alert('Please login to share your story');
            window.location.href = 'login.html';
            return;
        }

        const title = document.getElementById('title').value;
        const hashtagsInput = document.getElementById('hashtags').value;
        const description = document.getElementById('description').value;
        const story = document.getElementById('story').value;
        const submitButton = e.target.querySelector('button[type="submit"]');

        if (!title.trim() || !hashtagsInput.trim() || !description.trim() || !story.trim()) {
            alert('Please fill in all fields.');
            return;
        }

        const hashtags = hashtagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
        
        // Show loading state
        submitButton.textContent = 'Posting...';
        submitButton.disabled = true;

        try {
            // --- DEBUGGING --- 
            console.log('Current User UID:', user.uid);
            const storyData = {
                title: title,
                hashtags: hashtags,
                description: description,
                story: story,
                userId: user.uid, // Ensure this is being included correctly
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                likes: 0,
                comments: []
            };
            console.log('Attempting to add story with data:', JSON.stringify(storyData));
            // --- END DEBUGGING ---
            
            // Use direct Firestore call with locally initialized db
            await db.collection('stories').add(storyData);

            alert('Story posted successfully!');
            window.location.href = 'stories.html';
        } catch (error) {
            console.error('Error posting story:', error);
            alert('Error posting story: ' + error.message);
            // Reset button state
            submitButton.textContent = 'Post Story';
            submitButton.disabled = false;
        }
    });

    // Theme toggle logic
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
      themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'ðŸŒž' : 'ðŸŒ™';
    });
    window.onload = () => {
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        themeToggle.textContent = 'ðŸŒž';
      } else {
        themeToggle.textContent = 'ðŸŒ™';
      }
    };
  </script>
</body>
</html>

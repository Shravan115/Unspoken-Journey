<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Share Your Story - Unspoken Journey's</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
        font-family: 'Poppins', sans-serif;
        background: url('https://hd.wallpaperswide.com/thumbs/story-t2.jpg') no-repeat center center/cover;
        color: #fff;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        overflow-y: auto;
        padding: 20px;
    }
    .form-container {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        width: 80%;
        max-width: 600px;
        color: black;
        text-align: center;
        animation: fadeIn 0.8s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    h2 {
        font-weight: 600;
        margin-bottom: 20px;
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
    }
    input, textarea {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.8);
        color: black;
        outline: none;
        transition: 0.3s;
        box-shadow: inset 3px 3px 8px rgba(0, 0, 0, 0.2);
    }
    textarea {
        height: 150px;
        resize: none;
    }
    .hashtag-suggestions {
        background: white;
        color: black;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        position: absolute;
        width: calc(100% - 40px);
        max-height: 150px;
        overflow-y: auto;
        display: none;
        text-align: left;
        padding: 10px;
    }
    .hashtag-suggestions div {
        padding: 8px;
        cursor: pointer;
        transition: background 0.3s;
    }
    .hashtag-suggestions div:hover {
        background: #ddd;
    }
    button {
        background: #ff5e62;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
        width: 100%;
        font-size: 16px;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
    }
    button:hover {
        background: white;
        color: #ff5e62;
        transform: scale(1.05);
        box-shadow: 7px 7px 20px rgba(0, 0, 0, 0.5);
    }

    /* Bottom Navigation */
    .bottom-nav {
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: space-around;
      align-items: center;
      position: fixed;
      bottom: 0;
      left: 0;
      padding: 15px 0;
      box-shadow: 0px -4px 8px rgba(0, 0, 0, 0.5);
    }

    .bottom-nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      padding: 10px 15px;
      transition: background 0.3s, transform 0.2s;
      border-radius: 5px;
      font-size: 14px;
    }

    .bottom-nav a:hover {
      background: #ffcc00;
      color: #141e30;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Share Your Story</h2>
    <p>Your experiences matter. Share your unique journey with us.</p>
    <form id="story-form">
      <input type="text" id="title" name="title" placeholder="Enter the title of your story" required>
      <input type="text" id="hashtags" name="hashtags" placeholder="Enter hashtags (comma-separated)" onkeyup="showSuggestions()" required>
      <div class="hashtag-suggestions" id="suggestions-box"></div>
      <textarea id="description" name="description" placeholder="Write a short description..." required></textarea>
      <textarea id="story" name="story" placeholder="Write your story here..." required></textarea>
      <button type="submit">Post Story</button>
    </form>
  </div>

  <div class="bottom-nav">
    <a href="index.html">Home</a>
    <a href="stories.html">Stories</a>
    <a href="share-story.html">Share Your Story</a>
    <a href="contact.html">Contact</a>
    <a href="about-us.html">About Us</a>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <!-- <script src="database.js"></script>  No longer needed for core function -->
  <script>
    // Initialize Firebase directly in share-story page
    const firebaseConfig = {
        apiKey: "AIzaSyAkR4rQhTC9P9rIUpJzLUGLPDIxpYW0nrc",
        authDomain: "unspoken-journeys.firebaseapp.com",
        projectId: "unspoken-journeys",
        storageBucket: "unspoken-journeys.appspot.com",
        messagingSenderId: "1085239903802",
        appId: "1:1085239903802:web:1c8140e85ab72645f21703",
        measurementId: "G-CHFJNLYK08"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
        console.log('Firebase initialized in share-story page');
    } else {
        console.log('Firebase already initialized');
    }
    
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // Hashtag suggestion logic (remains the same)
    const availableHashtags = ["#Suspense", "#Comedy", "#Romance", "#Horror", "#SciFi", "#Drama", "#Fantasy", "#Historical","#Adventure", "#LifeLessons", "#Friendship", "#Love", "#Inspiration", "#Motivation", "#Travel", "#PersonalGrowth", "#Success", "#Happiness", "#SelfImprovement", "#Wellness", "#Mindfulness", "#Growth", "#Courage", "#Hope", "#Dreams", "#Storytelling", "#Achievement", "#LifeChanging", "#Passion", "#Hustle", "#Career", "#Family", "#LessonsLearned", "#Joy", "#Memories", "#Gratitude", "#OvercomingChallenges", "#NewBeginnings", "#Transformation", "#LifeJourney", "#Strength", "#SelfDiscovery", "#Kindness", "#Resilience", "#HappinessMatters", "#LifeGoals", "#Wisdom", "#HardWork", "#Creativity", "#ExpressYourself", "#EmotionalGrowth", "#Perseverance", "#LoveLife", "#Authenticity", "#Mindset", "#BelieveInYourself", "#InnerPeace", "#MentalHealthAwareness", "#StorySharing", "#Faith", "#Healing", "#ExperienceMatters", "#Determination", "#Encouragement", "#BeYourself"]
    function showSuggestions() {
        let input = document.getElementById("hashtags").value.toLowerCase();
        let suggestionsBox = document.getElementById("suggestions-box");
        suggestionsBox.innerHTML = "";
        if (input.length < 2) {
            suggestionsBox.style.display = "none";
            return;
        }
        let suggestions = availableHashtags.filter(tag => tag.toLowerCase().startsWith(input));
        suggestions.forEach(tag => {
            let div = document.createElement("div");
            div.textContent = tag;
            div.onclick = function() {
                document.getElementById("hashtags").value += (document.getElementById("hashtags").value ? ", " : "") + tag;
                suggestionsBox.style.display = "none";
            };
            suggestionsBox.appendChild(div);
        });
        suggestionsBox.style.display = suggestions.length ? "block" : "none";
    }

    // Handle story form submission
    document.getElementById('story-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const user = auth.currentUser; // Use the locally initialized auth
        if (!user) {
            alert('Please login to share your story');
            window.location.href = 'login.html';
            return;
        }

        const title = document.getElementById('title').value;
        const hashtagsInput = document.getElementById('hashtags').value;
        const description = document.getElementById('description').value;
        const story = document.getElementById('story').value;
        const submitButton = e.target.querySelector('button[type="submit"]');

        if (!title.trim() || !hashtagsInput.trim() || !description.trim() || !story.trim()) {
            alert('Please fill in all fields.');
            return;
        }

        const hashtags = hashtagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
        
        // Show loading state
        submitButton.textContent = 'Posting...';
        submitButton.disabled = true;

        try {
            // --- DEBUGGING --- 
            console.log('Current User UID:', user.uid);
            const storyData = {
                title: title,
                hashtags: hashtags,
                description: description,
                story: story,
                userId: user.uid, // Ensure this is being included correctly
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                likes: 0,
                comments: []
            };
            console.log('Attempting to add story with data:', JSON.stringify(storyData));
            // --- END DEBUGGING ---
            
            // Use direct Firestore call with locally initialized db
            await db.collection('stories').add(storyData);

            alert('Story posted successfully!');
            window.location.href = 'stories.html';
        } catch (error) {
            console.error('Error posting story:', error);
            alert('Error posting story: ' + error.message);
            // Reset button state
            submitButton.textContent = 'Post Story';
            submitButton.disabled = false;
        }
    });
  </script>
</body>
</html>
